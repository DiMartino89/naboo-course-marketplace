<div *ngIf="authService.isLoggedIn && authService.isEnabled">
    <h1>{{'Posteingang'| translate }}</h1>

    <table class="table">
        <thead>
        <tr>
            <th>{{'Betreff'| translate }}</th>
            <th>{{'Absender'| translate }}</th>
            <th>{{'Datum'| translate }}</th>
            <th>{{'Operationen'| translate }}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let message of messages">
            <td>
                <strong *ngIf="!message.read">
                    <a routerLink="/messages/{{ message.id }}">{{ message.subject }}</a>
                </strong>

                <a *ngIf="message.read" routerLink="/messages/{{ message.id }}">{{ message.subject }}</a>
            </td>
            <td>{{ message.from.profile?.display_name || message.from.email }}</td>
            <td>{{ message.created_at | date: 'dd.MM.yyyy HH:mm:ss'}}</td>
            <td>
                <app-button (click)="openMessageModal(message)" [size]="'sm'">{{'Antwort'| translate }}</app-button>
                <app-button (click)="archive(message.id)" [type]="'secondary'" [size]="'sm'">{{'Archivieren' | translate}}</app-button>
                <app-button (click)="remove(message.id)" [type]="'secondary'" [size]="'sm'">{{'LÃ¶schen' | translate}}</app-button>
            </td>
        </tr>

        <tr *ngIf="messages === null && authService.isEnabled">
            <td colspan="4"><app-loading></app-loading></td>
        </tr>

        <tr *ngIf="messages !== null && messages.length === 0 && authService.isEnabled">
            <td colspan="4">{{'Keine Nachrichten!'| translate }}</td>
        </tr>
        </tbody>
    </table>
</div>


<div class="modal fade" id="reply-modal" tabindex="-1" role="dialog" aria-labelledby="reply__label" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reply__label">{{'Nachricht beantworten'| translate }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <alert [service]="true"></alert>
                <form (ngSubmit)="messageForm.valid && sendMessage()">
                    <app-input field="subject" type="text" [form]="messageForm" [tabindex]="1"
                               [label]="'Betreff'| translate"  [errorText]="'Bitte Betreff mit maximal 100 Zeichen eingeben!'| translate"
                    ></app-input>

                    <app-input field="text" type="textarea" [form]="messageForm" [tabindex]="2"
                               [label]="'Nachricht'" [errorText]="'Bitte Nachricht mit maximal 1000 Zeichen eingeben!'| translate"
                    ></app-input>

                    <app-button [disabled]="!messageForm.valid" [tabindex]="3">{{'Nachricht senden' | translate}}</app-button>
                </form>
            </div>
        </div>
    </div>
</div>
